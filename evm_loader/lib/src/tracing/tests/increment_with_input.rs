use std::rc::Rc;

use ethnum::U256;
use map_macro::hash_map;
use solana_sdk::account::Account;

use evm_loader::account::ContractAccount;
use evm_loader::account_storage::AccountStorage;
use evm_loader::evm::database::Database;
use evm_loader::executor::ExecutorState;
use evm_loader::solana_program::pubkey::Pubkey;
use evm_loader::types::Address;

use crate::commands::emulate::emulate_trx;
use crate::commands::get_config::BuildConfigSimulator;
use crate::commands::trace::into_traces;
use crate::rpc::Rpc;
use crate::tracing::tests::helpers;
use crate::tracing::tests::helpers::rent_account;
use crate::tracing::tests::helpers::TestRpc;
use crate::tracing::tracers::new_tracer;
use crate::tracing::TraceConfig;
use crate::types::TxParams;

#[tokio::test]
async fn test_trace_increment_with_input() {
    trace_increment_with_input(TraceConfig::default(), "{\"gas\":10000,\"failed\":false,\"returnValue\":\"0000000000000000000000000000000000000000000000000000000000000087\",\"structLogs\":[{\"pc\":0,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[]},{\"pc\":2,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x80\"]},{\"pc\":4,\"op\":\"MSTORE\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x80\",\"0x40\"]},{\"pc\":5,\"op\":\"CALLVALUE\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[]},{\"pc\":6,\"op\":\"DUP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x0\"]},{\"pc\":7,\"op\":\"ISZERO\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x0\",\"0x0\"]},{\"pc\":8,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x0\",\"0x1\"]},{\"pc\":11,\"op\":\"JUMPI\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x0\",\"0x1\",\"0x10\"]},{\"pc\":16,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x0\"]},{\"pc\":17,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x0\"]},{\"pc\":18,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[]},{\"pc\":20,\"op\":\"CALLDATASIZE\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x4\"]},{\"pc\":21,\"op\":\"LT\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x4\",\"0x24\"]},{\"pc\":22,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x0\"]},{\"pc\":25,\"op\":\"JUMPI\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x0\",\"0x62\"]},{\"pc\":26,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[]},{\"pc\":28,\"op\":\"CALLDATALOAD\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x0\"]},{\"pc\":29,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd500000000000000000000000000000000000000000000000000000000\"]},{\"pc\":31,\"op\":\"SHR\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd500000000000000000000000000000000000000000000000000000000\",\"0xe0\"]},{\"pc\":32,\"op\":\"DUP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\"]},{\"pc\":33,\"op\":\"PUSH4\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x67d5cd5\"]},{\"pc\":38,\"op\":\"EQ\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x67d5cd5\",\"0x67d5cd5\"]},{\"pc\":39,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x1\"]},{\"pc\":42,\"op\":\"JUMPI\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x1\",\"0x67\"]},{\"pc\":103,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\"]},{\"pc\":104,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\"]},{\"pc\":107,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\"]},{\"pc\":109,\"op\":\"DUP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x4\"]},{\"pc\":110,\"op\":\"CALLDATASIZE\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x4\",\"0x4\"]},{\"pc\":111,\"op\":\"SUB\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x4\",\"0x4\",\"0x24\"]},{\"pc\":112,\"op\":\"DUP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x4\",\"0x20\"]},{\"pc\":113,\"op\":\"ADD\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x4\",\"0x20\",\"0x4\"]},{\"pc\":114,\"op\":\"SWAP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x4\",\"0x24\"]},{\"pc\":115,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x24\",\"0x4\"]},{\"pc\":118,\"op\":\"SWAP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x24\",\"0x4\",\"0x7c\"]},{\"pc\":119,\"op\":\"SWAP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x4\",\"0x24\"]},{\"pc\":120,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\"]},{\"pc\":123,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x1f2\"]},{\"pc\":498,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\"]},{\"pc\":499,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\"]},{\"pc\":501,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\"]},{\"pc\":503,\"op\":\"DUP3\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x20\"]},{\"pc\":504,\"op\":\"DUP5\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x20\",\"0x4\"]},{\"pc\":505,\"op\":\"SUB\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x20\",\"0x4\",\"0x24\"]},{\"pc\":506,\"op\":\"SLT\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x20\",\"0x20\"]},{\"pc\":507,\"op\":\"ISZERO\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\"]},{\"pc\":508,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x1\"]},{\"pc\":511,\"op\":\"JUMPI\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x1\",\"0x208\"]},{\"pc\":520,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\"]},{\"pc\":521,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\"]},{\"pc\":523,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\"]},{\"pc\":526,\"op\":\"DUP5\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\"]},{\"pc\":527,\"op\":\"DUP3\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\"]},{\"pc\":528,\"op\":\"DUP6\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x0\"]},{\"pc\":529,\"op\":\"ADD\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x0\",\"0x4\"]},{\"pc\":530,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\"]},{\"pc\":533,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0x1dd\"]},{\"pc\":477,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\"]},{\"pc\":478,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\"]},{\"pc\":480,\"op\":\"DUP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0x0\"]},{\"pc\":481,\"op\":\"CALLDATALOAD\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0x0\",\"0x4\"]},{\"pc\":482,\"op\":\"SWAP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0x0\",\"0xc\"]},{\"pc\":483,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x0\"]},{\"pc\":484,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\"]},{\"pc\":487,\"op\":\"DUP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\"]},{\"pc\":488,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\"]},{\"pc\":491,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\",\"0x1c6\"]},{\"pc\":454,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\"]},{\"pc\":455,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\"]},{\"pc\":458,\"op\":\"DUP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\",\"0x1cf\"]},{\"pc\":459,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\",\"0x1cf\",\"0xc\"]},{\"pc\":462,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\",\"0x1cf\",\"0xc\",\"0x1bc\"]},{\"pc\":444,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\",\"0x1cf\",\"0xc\"]},{\"pc\":445,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\",\"0x1cf\",\"0xc\"]},{\"pc\":447,\"op\":\"DUP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\",\"0x1cf\",\"0xc\",\"0x0\"]},{\"pc\":448,\"op\":\"SWAP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\",\"0x1cf\",\"0xc\",\"0x0\",\"0xc\"]},{\"pc\":449,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\",\"0x1cf\",\"0xc\",\"0xc\",\"0x0\"]},{\"pc\":450,\"op\":\"SWAP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\",\"0x1cf\",\"0xc\",\"0xc\"]},{\"pc\":451,\"op\":\"SWAP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\",\"0xc\",\"0xc\",\"0x1cf\"]},{\"pc\":452,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\",\"0xc\",\"0x1cf\",\"0xc\"]},{\"pc\":453,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\",\"0xc\",\"0x1cf\"]},{\"pc\":463,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\",\"0xc\"]},{\"pc\":464,\"op\":\"DUP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\",\"0xc\"]},{\"pc\":465,\"op\":\"EQ\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\",\"0xc\",\"0xc\"]},{\"pc\":466,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\",\"0x1\"]},{\"pc\":469,\"op\":\"JUMPI\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\",\"0x1\",\"0x1da\"]},{\"pc\":474,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\"]},{\"pc\":475,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\",\"0xc\"]},{\"pc\":476,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\",\"0x1ec\"]},{\"pc\":492,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\"]},{\"pc\":493,\"op\":\"SWAP3\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0x216\",\"0x24\",\"0x4\",\"0xc\"]},{\"pc\":494,\"op\":\"SWAP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0xc\",\"0x24\",\"0x4\",\"0x216\"]},{\"pc\":495,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0xc\",\"0x216\",\"0x4\",\"0x24\"]},{\"pc\":496,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0xc\",\"0x216\",\"0x4\"]},{\"pc\":497,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0xc\",\"0x216\"]},{\"pc\":534,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0xc\"]},{\"pc\":535,\"op\":\"SWAP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0x0\",\"0x0\",\"0xc\"]},{\"pc\":536,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0xc\",\"0x0\",\"0x0\"]},{\"pc\":537,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0xc\",\"0x0\"]},{\"pc\":538,\"op\":\"SWAP3\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0x7c\",\"0x24\",\"0x4\",\"0xc\"]},{\"pc\":539,\"op\":\"SWAP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x24\",\"0x4\",\"0x7c\"]},{\"pc\":540,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x7c\",\"0x4\",\"0x24\"]},{\"pc\":541,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x7c\",\"0x4\"]},{\"pc\":542,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x7c\"]},{\"pc\":124,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\"]},{\"pc\":125,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\"]},{\"pc\":128,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x129\"]},{\"pc\":297,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\"]},{\"pc\":298,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\"]},{\"pc\":300,\"op\":\"DUP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\"]},{\"pc\":301,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\"]},{\"pc\":303,\"op\":\"DUP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\"]},{\"pc\":304,\"op\":\"DUP3\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\"]},{\"pc\":305,\"op\":\"DUP3\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0xc\"]},{\"pc\":306,\"op\":\"SLOAD\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0xc\",\"0x0\"],\"storage\":{\"0000000000000000000000000000000000000000000000000000000000000000\":\"000000000000000000000000000000000000000000000000000000000000007b\"}},{\"pc\":307,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0xc\",\"0x7b\"]},{\"pc\":310,\"op\":\"SWAP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0xc\",\"0x7b\",\"0x13c\"]},{\"pc\":311,\"op\":\"SWAP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0x7b\",\"0xc\"]},{\"pc\":312,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\"]},{\"pc\":315,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x278\"]},{\"pc\":632,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\"]},{\"pc\":633,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\"]},{\"pc\":635,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\"]},{\"pc\":638,\"op\":\"DUP3\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x283\"]},{\"pc\":639,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x283\",\"0x7b\"]},{\"pc\":642,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x283\",\"0x7b\",\"0x1bc\"]},{\"pc\":444,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x283\",\"0x7b\"]},{\"pc\":445,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x283\",\"0x7b\"]},{\"pc\":447,\"op\":\"DUP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x283\",\"0x7b\",\"0x0\"]},{\"pc\":448,\"op\":\"SWAP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x283\",\"0x7b\",\"0x0\",\"0x7b\"]},{\"pc\":449,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x283\",\"0x7b\",\"0x7b\",\"0x0\"]},{\"pc\":450,\"op\":\"SWAP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x283\",\"0x7b\",\"0x7b\"]},{\"pc\":451,\"op\":\"SWAP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x7b\",\"0x7b\",\"0x283\"]},{\"pc\":452,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x7b\",\"0x283\",\"0x7b\"]},{\"pc\":453,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x7b\",\"0x283\"]},{\"pc\":643,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x7b\"]},{\"pc\":644,\"op\":\"SWAP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x7b\"]},{\"pc\":645,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x7b\"]},{\"pc\":646,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\"]},{\"pc\":649,\"op\":\"DUP4\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x28e\"]},{\"pc\":650,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x28e\",\"0xc\"]},{\"pc\":653,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x28e\",\"0xc\",\"0x1bc\"]},{\"pc\":444,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x28e\",\"0xc\"]},{\"pc\":445,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x28e\",\"0xc\"]},{\"pc\":447,\"op\":\"DUP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x28e\",\"0xc\",\"0x0\"]},{\"pc\":448,\"op\":\"SWAP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x28e\",\"0xc\",\"0x0\",\"0xc\"]},{\"pc\":449,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x28e\",\"0xc\",\"0xc\",\"0x0\"]},{\"pc\":450,\"op\":\"SWAP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x28e\",\"0xc\",\"0xc\"]},{\"pc\":451,\"op\":\"SWAP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0xc\",\"0xc\",\"0x28e\"]},{\"pc\":452,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0xc\",\"0x28e\",\"0xc\"]},{\"pc\":453,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0xc\",\"0x28e\"]},{\"pc\":654,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0xc\"]},{\"pc\":655,\"op\":\"SWAP3\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0xc\"]},{\"pc\":656,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0xc\"]},{\"pc\":657,\"op\":\"DUP3\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\"]},{\"pc\":658,\"op\":\"DUP3\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0xc\"]},{\"pc\":659,\"op\":\"ADD\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0xc\",\"0x7b\"]},{\"pc\":660,\"op\":\"SWAP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x0\",\"0x87\"]},{\"pc\":661,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x87\",\"0x0\"]},{\"pc\":662,\"op\":\"DUP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x87\"]},{\"pc\":663,\"op\":\"DUP3\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x87\",\"0x87\"]},{\"pc\":664,\"op\":\"GT\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x87\",\"0x87\",\"0x7b\"]},{\"pc\":665,\"op\":\"ISZERO\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x87\",\"0x0\"]},{\"pc\":666,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x87\",\"0x1\"]},{\"pc\":669,\"op\":\"JUMPI\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x87\",\"0x1\",\"0x2a6\"]},{\"pc\":678,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x87\"]},{\"pc\":679,\"op\":\"SWAP3\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x13c\",\"0xc\",\"0x7b\",\"0x87\"]},{\"pc\":680,\"op\":\"SWAP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x87\",\"0xc\",\"0x7b\",\"0x13c\"]},{\"pc\":681,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x87\",\"0x13c\",\"0x7b\",\"0xc\"]},{\"pc\":682,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x87\",\"0x13c\",\"0x7b\"]},{\"pc\":683,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x87\",\"0x13c\"]},{\"pc\":316,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x87\"]},{\"pc\":317,\"op\":\"SWAP3\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0xc\",\"0x0\",\"0x0\",\"0x87\"]},{\"pc\":318,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0x87\",\"0x0\",\"0x0\",\"0xc\"]},{\"pc\":319,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0x87\",\"0x0\",\"0x0\"]},{\"pc\":320,\"op\":\"DUP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0x87\",\"0x0\"]},{\"pc\":321,\"op\":\"SWAP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0x87\",\"0x0\",\"0x87\"]},{\"pc\":322,\"op\":\"SSTORE\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0x87\",\"0x87\",\"0x0\"],\"storage\":{\"0000000000000000000000000000000000000000000000000000000000000000\":\"0000000000000000000000000000000000000000000000000000000000000087\"}},{\"pc\":323,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0x87\"]},{\"pc\":324,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\"]},{\"pc\":326,\"op\":\"SLOAD\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0x0\"],\"storage\":{\"0000000000000000000000000000000000000000000000000000000000000000\":\"0000000000000000000000000000000000000000000000000000000000000087\"}},{\"pc\":327,\"op\":\"SWAP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x0\",\"0x87\"]},{\"pc\":328,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x87\",\"0x0\"]},{\"pc\":329,\"op\":\"SWAP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x81\",\"0xc\",\"0x87\"]},{\"pc\":330,\"op\":\"SWAP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x87\",\"0xc\",\"0x81\"]},{\"pc\":331,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x87\",\"0x81\",\"0xc\"]},{\"pc\":332,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x87\",\"0x81\"]},{\"pc\":129,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x87\"]},{\"pc\":130,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x87\"]},{\"pc\":132,\"op\":\"MLOAD\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x87\",\"0x40\"]},{\"pc\":133,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x87\",\"0x80\"]},{\"pc\":136,\"op\":\"SWAP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x87\",\"0x80\",\"0x8e\"]},{\"pc\":137,\"op\":\"SWAP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x80\",\"0x87\"]},{\"pc\":138,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\"]},{\"pc\":141,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0x22e\"]},{\"pc\":558,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\"]},{\"pc\":559,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\"]},{\"pc\":561,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0x0\"]},{\"pc\":563,\"op\":\"DUP3\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0x0\",\"0x20\"]},{\"pc\":564,\"op\":\"ADD\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0x0\",\"0x20\",\"0x80\"]},{\"pc\":565,\"op\":\"SWAP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0x0\",\"0xa0\"]},{\"pc\":566,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x0\"]},{\"pc\":567,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\"]},{\"pc\":570,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\"]},{\"pc\":572,\"op\":\"DUP4\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x0\"]},{\"pc\":573,\"op\":\"ADD\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x0\",\"0x80\"]},{\"pc\":574,\"op\":\"DUP5\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\"]},{\"pc\":575,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\",\"0x87\"]},{\"pc\":578,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\",\"0x87\",\"0x21f\"]},{\"pc\":543,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\",\"0x87\"]},{\"pc\":544,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\",\"0x87\"]},{\"pc\":547,\"op\":\"DUP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\",\"0x87\",\"0x228\"]},{\"pc\":548,\"op\":\"PUSH2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\",\"0x87\",\"0x228\",\"0x87\"]},{\"pc\":551,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\",\"0x87\",\"0x228\",\"0x87\",\"0x1bc\"]},{\"pc\":444,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\",\"0x87\",\"0x228\",\"0x87\"]},{\"pc\":445,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\",\"0x87\",\"0x228\",\"0x87\"]},{\"pc\":447,\"op\":\"DUP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\",\"0x87\",\"0x228\",\"0x87\",\"0x0\"]},{\"pc\":448,\"op\":\"SWAP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\",\"0x87\",\"0x228\",\"0x87\",\"0x0\",\"0x87\"]},{\"pc\":449,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\",\"0x87\",\"0x228\",\"0x87\",\"0x87\",\"0x0\"]},{\"pc\":450,\"op\":\"SWAP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\",\"0x87\",\"0x228\",\"0x87\",\"0x87\"]},{\"pc\":451,\"op\":\"SWAP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\",\"0x87\",\"0x87\",\"0x87\",\"0x228\"]},{\"pc\":452,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\",\"0x87\",\"0x87\",\"0x228\",\"0x87\"]},{\"pc\":453,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\",\"0x87\",\"0x87\",\"0x228\"]},{\"pc\":552,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\",\"0x87\",\"0x87\"]},{\"pc\":553,\"op\":\"DUP3\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\",\"0x87\",\"0x87\"]},{\"pc\":554,\"op\":\"MSTORE\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\",\"0x87\",\"0x87\",\"0x80\"]},{\"pc\":555,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\",\"0x87\"]},{\"pc\":556,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\",\"0x80\"]},{\"pc\":557,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\",\"0x243\"]},{\"pc\":579,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\"]},{\"pc\":580,\"op\":\"SWAP3\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x8e\",\"0x87\",\"0x80\",\"0xa0\"]},{\"pc\":581,\"op\":\"SWAP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0xa0\",\"0x87\",\"0x80\",\"0x8e\"]},{\"pc\":582,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0xa0\",\"0x8e\",\"0x80\",\"0x87\"]},{\"pc\":583,\"op\":\"POP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0xa0\",\"0x8e\",\"0x80\"]},{\"pc\":584,\"op\":\"JUMP\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0xa0\",\"0x8e\"]},{\"pc\":142,\"op\":\"JUMPDEST\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0xa0\"]},{\"pc\":143,\"op\":\"PUSH1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0xa0\"]},{\"pc\":145,\"op\":\"MLOAD\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0xa0\",\"0x40\"]},{\"pc\":146,\"op\":\"DUP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0xa0\",\"0x80\"]},{\"pc\":147,\"op\":\"SWAP2\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0xa0\",\"0x80\",\"0x80\"]},{\"pc\":148,\"op\":\"SUB\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x80\",\"0x80\",\"0xa0\"]},{\"pc\":149,\"op\":\"SWAP1\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x80\",\"0x20\"]},{\"pc\":150,\"op\":\"RETURN\",\"gas\":0,\"gasCost\":0,\"depth\":1,\"stack\":[\"0x67d5cd5\",\"0x20\",\"0x80\"]}]}").await;
}

#[tokio::test]
async fn test_trace_state_diff_increment_with_input() {
    trace_increment_with_input(helpers::state_diff_trace_config(), "{\"output\":\"0x0000000000000000000000000000000000000000000000000000000000000087\",\"stateDiff\":{\"0x356726f027a805fab3bd7dd0413a96d81bc6f599\":{\"balance\":\"=\",\"nonce\":\"=\",\"code\":\"=\",\"storage\":{\"0x0000000000000000000000000000000000000000000000000000000000000000\":{\"*\":{\"from\":\"0x000000000000000000000000000000000000000000000000000000000000007b\",\"to\":\"0x0000000000000000000000000000000000000000000000000000000000000087\"}}}},\"0x82211934c340b29561381392348d48413e15adc8\":{\"balance\":{\"*\":{\"from\":\"0x4692885e28cc02260\",\"to\":\"0x4691bba948aba7cc0\"}},\"nonce\":{\"*\":{\"from\":\"0x7\",\"to\":\"0x8\"}},\"code\":\"=\",\"storage\":{}}},\"trace\":[],\"vmTrace\":null}").await;
}

#[tokio::test]
async fn test_trace_prestate_increment_with_input() {
    trace_increment_with_input(helpers::prestate_trace_config(), "{\"0x356726f027a805fab3bd7dd0413a96d81bc6f599\":{\"balance\":\"0x0\",\"code\":\"0x608060405234801561001057600080fd5b50600436106100625760003560e01c8063067d5cd5146100675780632e64cec1146100975780636057361d146100b5578063873d1a02146100d1578063d09de08a146100ef578063f315cde1146100f9575b600080fd5b610081600480360381019061007c91906101f2565b610129565b60405161008e919061022e565b60405180910390f35b61009f61014d565b6040516100ac919061022e565b60405180910390f35b6100cf60048036038101906100ca91906101f2565b610156565b005b6100d9610160565b6040516100e6919061022e565b60405180910390f35b6100f7610183565b005b610113600480360381019061010e91906101f2565b61019e565b604051610120919061022e565b60405180910390f35b60008160008082825461013c9190610278565b925050819055506000549050919050565b60008054905090565b8060008190555050565b600060016000808282546101749190610278565b92505081905550600054905090565b60016000808282546101959190610278565b92505081905550565b60006001826101ad9190610278565b9150819050919050565b600080fd5b6000819050919050565b6101cf816101bc565b81146101da57600080fd5b50565b6000813590506101ec816101c6565b92915050565b600060208284031215610208576102076101b7565b5b6000610216848285016101dd565b91505092915050565b610228816101bc565b82525050565b6000602082019050610243600083018461021f565b92915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000610283826101bc565b915061028e836101bc565b92508282019050808211156102a6576102a5610249565b5b9291505056fea26469706673582212200c26f8a7cee5f02a2c936bb530e313bf967ef65a27ad9afbc4074e2f407ff83464736f6c63430008130033\",\"nonce\":1,\"storage\":{\"0x0000000000000000000000000000000000000000000000000000000000000000\":\"0x000000000000000000000000000000000000000000000000000000000000007b\"}},\"0x82211934c340b29561381392348d48413e15adc8\":{\"balance\":\"0x4692885e28cc02260\",\"nonce\":7}}").await;
}

#[tokio::test]
async fn test_trace_prestate_diff_mode_increment_with_input() {
    trace_increment_with_input(helpers::prestate_diff_mode_trace_config(), "{\"post\":{\"0x356726f027a805fab3bd7dd0413a96d81bc6f599\":{\"storage\":{\"0x0000000000000000000000000000000000000000000000000000000000000000\":\"0x0000000000000000000000000000000000000000000000000000000000000087\"}},\"0x82211934c340b29561381392348d48413e15adc8\":{\"balance\":\"0x4691bba948aba7cc0\",\"nonce\":8}},\"pre\":{\"0x356726f027a805fab3bd7dd0413a96d81bc6f599\":{\"balance\":\"0x0\",\"code\":\"0x608060405234801561001057600080fd5b50600436106100625760003560e01c8063067d5cd5146100675780632e64cec1146100975780636057361d146100b5578063873d1a02146100d1578063d09de08a146100ef578063f315cde1146100f9575b600080fd5b610081600480360381019061007c91906101f2565b610129565b60405161008e919061022e565b60405180910390f35b61009f61014d565b6040516100ac919061022e565b60405180910390f35b6100cf60048036038101906100ca91906101f2565b610156565b005b6100d9610160565b6040516100e6919061022e565b60405180910390f35b6100f7610183565b005b610113600480360381019061010e91906101f2565b61019e565b604051610120919061022e565b60405180910390f35b60008160008082825461013c9190610278565b925050819055506000549050919050565b60008054905090565b8060008190555050565b600060016000808282546101749190610278565b92505081905550600054905090565b60016000808282546101959190610278565b92505081905550565b60006001826101ad9190610278565b9150819050919050565b600080fd5b6000819050919050565b6101cf816101bc565b81146101da57600080fd5b50565b6000813590506101ec816101c6565b92915050565b600060208284031215610208576102076101b7565b5b6000610216848285016101dd565b91505092915050565b610228816101bc565b82525050565b6000602082019050610243600083018461021f565b92915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000610283826101bc565b915061028e836101bc565b92508282019050808211156102a6576102a5610249565b5b9291505056fea26469706673582212200c26f8a7cee5f02a2c936bb530e313bf967ef65a27ad9afbc4074e2f407ff83464736f6c63430008130033\",\"nonce\":1,\"storage\":{\"0x0000000000000000000000000000000000000000000000000000000000000000\":\"0x000000000000000000000000000000000000000000000000000000000000007b\"}},\"0x82211934c340b29561381392348d48413e15adc8\":{\"balance\":\"0x4692885e28cc02260\",\"nonce\":7}}}").await;
}

async fn trace_increment_with_input(trace_config: TraceConfig, expected_trace: &str) {
    let gas_used = Some(U256::from(10_000u64));
    let chain_id = 1234;

    let tracer = new_tracer(gas_used, trace_config).unwrap();

    let origin = Address::from_hex("0x82211934c340b29561381392348d48413e15adc8").unwrap();
    let target = Address::from_hex("0x356726f027a805fab3bd7dd0413a96d81bc6f599").unwrap();

    let index = U256::ZERO;

    let program_id = Pubkey::new_unique();

    let initial_storage = U256::from(123u8);

    let rpc =
        increment_with_input_test_rpc(program_id, origin, target, index, chain_id, initial_storage)
            .await;

    let mut test_account_storage =
        helpers::test_emulator_account_storage(program_id, &rpc, chain_id).await;

    let trx = increment_with_input_tx_params(gas_used, origin, target).await;

    let mut backend = ExecutorState::new(&mut test_account_storage);

    let emulate_response = emulate_trx(trx, &mut backend, 10000, Some(Rc::clone(&tracer)))
        .await
        .unwrap();

    assert_eq!(emulate_response.exit_status, "succeed"); // todo why stop?
    assert_eq!(
        emulate_response.result,
        (initial_storage + 12).to_be_bytes()
    );
    assert_eq!(emulate_response.steps_executed, 243);
    assert_eq!(emulate_response.used_gas, 25_000);
    assert_eq!(emulate_response.iterations, 3);
    assert_eq!(emulate_response.solana_accounts.len(), 2);

    let result = into_traces(tracer, emulate_response);

    assert_eq!(
        serde_json::to_string(&result).unwrap(),
        expected_trace.to_string()
    );

    assert_eq!(
        U256::from_be_bytes(backend.storage(target, index).await.unwrap()),
        U256::from_be_bytes(test_account_storage.storage(target, index).await) + 12
    );
}

async fn increment_with_input_tx_params(
    gas_used: Option<U256>,
    origin: Address,
    target: Address,
) -> TxParams {
    TxParams {
        from: origin,
        to: Some(target),
        data: Some(
            hex::decode("067d5cd5000000000000000000000000000000000000000000000000000000000000000c")
                .unwrap(),
        ),
        gas_used,
        gas_price: Some(U256::from(360_123_562_234_u64)),
        gas_limit: Some(U256::from(30_000u64)),
        ..TxParams::default()
    }
}

async fn increment_with_input_test_rpc(
    program_id: Pubkey,
    origin: Address,
    target: Address,
    index: U256,
    chain_id: u64,
    initial_storage: U256,
) -> impl Rpc + BuildConfigSimulator {
    let (origin_pubkey, origin_account) = helpers::balance_account_with_data(
        &program_id,
        origin,
        chain_id,
        7,
        U256::from_str_hex("0x4692885e28cc02260").unwrap(),
    );

    let (target_pubkey, target_account) =
        helpers::balance_account_with_data(&program_id, target, chain_id, 1, U256::ZERO);

    let code_vec = hex::decode("608060405234801561001057600080fd5b50600436106100625760003560e01c8063067d5cd5146100675780632e64cec1146100975780636057361d146100b5578063873d1a02146100d1578063d09de08a146100ef578063f315cde1146100f9575b600080fd5b610081600480360381019061007c91906101f2565b610129565b60405161008e919061022e565b60405180910390f35b61009f61014d565b6040516100ac919061022e565b60405180910390f35b6100cf60048036038101906100ca91906101f2565b610156565b005b6100d9610160565b6040516100e6919061022e565b60405180910390f35b6100f7610183565b005b610113600480360381019061010e91906101f2565b61019e565b604051610120919061022e565b60405180910390f35b60008160008082825461013c9190610278565b925050819055506000549050919050565b60008054905090565b8060008190555050565b600060016000808282546101749190610278565b92505081905550600054905090565b60016000808282546101959190610278565b92505081905550565b60006001826101ad9190610278565b9150819050919050565b600080fd5b6000819050919050565b6101cf816101bc565b81146101da57600080fd5b50565b6000813590506101ec816101c6565b92915050565b600060208284031215610208576102076101b7565b5b6000610216848285016101dd565b91505092915050565b610228816101bc565b82525050565b6000602082019050610243600083018461021f565b92915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000610283826101bc565b915061028e836101bc565b92508282019050808211156102a6576102a5610249565b5b9291505056fea26469706673582212200c26f8a7cee5f02a2c936bb530e313bf967ef65a27ad9afbc4074e2f407ff83464736f6c63430008130033").unwrap();

    let (target_code_pubkey, _) = target.find_solana_address(&program_id);
    let mut target_code_account = Account::new(
        0,
        ContractAccount::required_account_size(&code_vec),
        &program_id,
    );
    let code_account_info =
        helpers::writable_account_info(&target_code_pubkey, &mut target_code_account);
    let mut contract = ContractAccount::new(
        &program_id,
        code_account_info,
        target,
        chain_id,
        0,
        &code_vec,
    )
    .unwrap();

    contract.set_storage_value(index.as_usize(), &initial_storage.to_be_bytes());

    TestRpc::new(hash_map! {
        origin_pubkey => origin_account,
        target_pubkey => target_account,
        target_code_pubkey => target_code_account,
        solana_sdk::sysvar::rent::id() => rent_account()
    })
}
